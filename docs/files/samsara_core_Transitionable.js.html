<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>samsara/core/Transitionable.js - SamsaraJS</title>
    <link rel="stylesheet" href="">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-skin-sam">
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <h1 class="brand" style="padding: 10px 16px 10px; height: 20px; line-height: 20px; margin-left: 0;">
        <!---->
	    <!--<img alt="SamsaraJS" src="../assets/css/logo.png" style="max-height: 65%;" title="SamsaraJS">-->
        <!---->
            SamsaraJS
        </h1>
	<div class="nav">
            <li class="divider-vertical"></li>
            <li>
                <p class="navbar-text">
                    API Docs for Version: <b>0.1.1</b>
                </p>
            </li>
        </div>
        <form class="navbar-form pull-right" style="line-height: 40px; height: 40px;">
            <input style="margin-top: 0;" type="text" class="search-query" placeholder="Search for classes/modules..." data-obj='["classes/Core.Controller", "classes/Core.ElementAllocator", "classes/Core.ElementOutput", "classes/Core.Engine", "classes/Core.LayoutNode", "classes/Core.OptionsManager", "classes/Core.SizeNode", "classes/Core.SUE", "classes/Core.Timer", "classes/Core.Transform", "classes/Core.Transitionable", "classes/Core.View", "classes/DOM.ContainerSurface", "classes/DOM.Context", "classes/DOM.Surface", "classes/Events.EventEmitter", "classes/Events.EventFilter", "classes/Events.EventHandler", "classes/Events.EventMapper", "classes/Events.EventSplitter", "classes/Inputs.GenericInput", "classes/Inputs.MouseInput", "classes/Inputs.PinchInput", "classes/Inputs.RotateInput", "classes/Inputs.ScaleInput", "classes/Inputs.ScrollInput", "classes/Inputs.TouchInput", "classes/Inputs.TouchTracker", "classes/Inputs.TwoFingerInput", "classes/Layouts.DrawerLayout", "classes/Layouts.FlexibleLayout", "classes/Layouts.GridLayout", "classes/Layouts.SequentialLayout", "classes/RenderTreeNode", "classes/RootNode", "classes/Streams.Accumulator", "classes/Streams.Differential", "classes/Streams.Observable", "classes/Streams.ResizeStream", "classes/Streams.SimpleStream", "classes/Streams.Stream", "classes/Transitions.Inertia", "classes/Transitions.Spring", "classes/Transitions.Tween"]'>
        </form>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="span3">
	    <div>
	        <!--<h3>APIs</h3>-->
	        <br>
	        <div id="sidebar">
	            <!--<ul id="main-nav" class="nav nav-tabs" style="margin-bottom:0;">-->
	                <!--<li class="active"><a href="#classes" data-toggle="tab">Classes</a></li>-->
	                <!--<li><a href="#modules" data-toggle="tab">Modules</a></li>-->
	            <!--</ul>-->
	    
	            <div id="api-tabview-filter">
	                <input type="search" placeholder="Type to filter APIs">
	            </div>
	    
	            <div class="tab-content" style="border: 1px solid #DDD; border-top:0;">
	                <div class="tab-pane active" id="classes">
	                    <ul id="api-classes" class="nav nav-list">
	                            <li><a href="../classes/Core.Timer.html">Core.Timer</a></li>
	                            <li><a href="../classes/Core.Transform.html">Core.Transform</a></li>
	                            <li><a href="../classes/Core.Transitionable.html">Core.Transitionable</a></li>
	                            <li><a href="../classes/Core.View.html">Core.View</a></li>
	                            <li><a href="../classes/DOM.ContainerSurface.html">DOM.ContainerSurface</a></li>
	                            <li><a href="../classes/DOM.Context.html">DOM.Context</a></li>
	                            <li><a href="../classes/DOM.Surface.html">DOM.Surface</a></li>
	                            <li><a href="../classes/Events.EventEmitter.html">Events.EventEmitter</a></li>
	                            <li><a href="../classes/Events.EventFilter.html">Events.EventFilter</a></li>
	                            <li><a href="../classes/Events.EventHandler.html">Events.EventHandler</a></li>
	                            <li><a href="../classes/Events.EventMapper.html">Events.EventMapper</a></li>
	                            <li><a href="../classes/Inputs.GenericInput.html">Inputs.GenericInput</a></li>
	                            <li><a href="../classes/Inputs.MouseInput.html">Inputs.MouseInput</a></li>
	                            <li><a href="../classes/Inputs.PinchInput.html">Inputs.PinchInput</a></li>
	                            <li><a href="../classes/Inputs.RotateInput.html">Inputs.RotateInput</a></li>
	                            <li><a href="../classes/Inputs.ScaleInput.html">Inputs.ScaleInput</a></li>
	                            <li><a href="../classes/Inputs.ScrollInput.html">Inputs.ScrollInput</a></li>
	                            <li><a href="../classes/Inputs.TouchInput.html">Inputs.TouchInput</a></li>
	                            <li><a href="../classes/Layouts.DrawerLayout.html">Layouts.DrawerLayout</a></li>
	                            <li><a href="../classes/Layouts.FlexibleLayout.html">Layouts.FlexibleLayout</a></li>
	                            <li><a href="../classes/Layouts.GridLayout.html">Layouts.GridLayout</a></li>
	                            <li><a href="../classes/Layouts.SequentialLayout.html">Layouts.SequentialLayout</a></li>
	                            <li><a href="../classes/Streams.Accumulator.html">Streams.Accumulator</a></li>
	                            <li><a href="../classes/Streams.Differential.html">Streams.Differential</a></li>
	                            <li><a href="../classes/Streams.Stream.html">Streams.Stream</a></li>
	                    </ul>
	                </div>
	    
	                <!--<div class="tab-pane" id="modules">-->
	                    <!--<ul id="api-modules" class="nav nav-list">-->
	                        <!---->
	                    <!--</ul>-->
	                <!--</div>-->
	            </div>
	        </div>
	    </div>
        </div>
        <div class="span9">
                <form id="options-form" class="form-inline pull-right">
                    Show:
                    <label for="api-show-inherited" class="checkbox">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected" class="checkbox">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private" class="checkbox">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated" class="checkbox">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </form>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<div class="page-header">
    <h1>samsara/core/Transitionable.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums">
/* Copyright Â© 2015 David Valdman */

define(function (require, exports, module) {
    var dirtyQueue = require(&#x27;./queues/dirtyQueue&#x27;);
    var preTickQueue = require(&#x27;./queues/preTickQueue&#x27;);
    var tickQueue = require(&#x27;./queues/tickQueue&#x27;);
    var EventHandler = require(&#x27;../events/EventHandler&#x27;);
    var SimpleStream = require(&#x27;../streams/SimpleStream&#x27;);
    var Stream = require(&#x27;../streams/Stream&#x27;);

    var Tween = require(&#x27;../transitions/Tween&#x27;);
    var Spring = require(&#x27;../transitions/Spring&#x27;);
    var Inertia = require(&#x27;../transitions/Inertia&#x27;);

    var transitionMethods = {
        tween: Tween,
        spring: Spring,
        inertia: Inertia
    };

    /**
     * A way to transition numeric values and arrays of numbers between start and end states.
     *  Transitions are given an easing curve and a duration.
     *  Non-numeric values are ignored.
     *
     *  @example
     *
     *      var transitionable = new Transitionable(0);
     *
     *      transitionable.set(100, {duration : 1000, curve : &#x27;easeIn&#x27;});
     *
     *      transitionable.on(&#x27;start&#x27;, function(value){
     *          console.log(value); // 0
     *      });
     *
     *      transitionable.on(&#x27;update&#x27;, function(value){
     *          console.log(value); // numbers between 0 and 100
     *      });
     *
     *      transitionable.on(&#x27;end&#x27;, function(value){
     *          console.log(value); // 100
     *      });
     *
     * @class Transitionable
     * @constructor
     * @extends Streams.SimpleStream
     * @param value {Number|Number[]}   Starting value
     */
    function Transitionable(value) {
        this.value = value || 0;
        this.velocity = 0;
        this._callback = undefined;
        this._method = null;
        this._active = false;
        this._currentActive = false;

        var hasUpdated = false;
        this.updateMethod = undefined;

        this._eventInput = new EventHandler();
        this._eventOutput = new EventHandler();
        EventHandler.setInputHandler(this, this._eventInput);
        EventHandler.setOutputHandler(this, this._eventOutput);

        this._eventInput.on(&#x27;start&#x27;, function (value) {
            this._currentActive = true;
            if (!this._active) {
                this.emit(&#x27;start&#x27;, value);
                this._active = true;
            }
        }.bind(this));

        this._eventInput.on(&#x27;update&#x27;, function (value) {
            hasUpdated = true;
            this.value = value;
            this.velocity = this._engineInstance.getVelocity();
            this.emit(&#x27;update&#x27;, value);
        }.bind(this));

        this._eventInput.on(&#x27;end&#x27;, function (value) {
            this.value = value;
            this._currentActive = false;

            if (this._callback) {
                var callback = this._callback;
                this._callback = undefined;
                callback();
            }

            if (!this._currentActive){
                this._active = false;
                hasUpdated = false;

                if (this._engineInstance)
                    this.velocity = this._engineInstance.getVelocity();

                this._active = false;
                this.emit(&#x27;end&#x27;, value);
            }
        }.bind(this));

        if (value !== undefined) {
            this.value = value;
            preTickQueue.push(function () {
                this.trigger(&#x27;start&#x27;, value);

                dirtyQueue.push(function () {
                    if (hasUpdated) return;
                    this.trigger(&#x27;end&#x27;, value);
                }.bind(this));
            }.bind(this));
        }
    }

    Transitionable.prototype = Object.create(SimpleStream.prototype);
    Transitionable.prototype.constructor = Transitionable;

    /**
     * Constructor method. A way of registering other engines that can interpolate
     *  between start and end values. For instance, a physics engine.
     *
     *  @method register
     *  @param name {string}    Identifier for the engine
     *  @param constructor      Constructor for the engine
     */
    Transitionable.register = function register(name, constructor) {
        if (!(name in transitionMethods))
            transitionMethods[name] = constructor;
    };

    /**
     * Constructor method. Unregister an interpolating engine.
     *  Undoes work of &#x60;register&#x60;.
     *
     *  @method unregister
     *  @param name {string}    Identifier for the engine
     */
    Transitionable.unregister = function unregister(name) {
        if (name in transitionMethods) {
            delete transitionMethods[name];
            return true;
        }
        else return false;
    };

    /**
     * Define a new end value that will be transitioned towards with the prescribed
     *  transition. An optional callback can fire when the transition completes.
     *
     * @method set
     * @param value {Number|Number[]}           End value
     * @param [transition] {Object}             Transition definition
     * @param [transition.curve] {string}       Easing curve name, e.g., &quot;easeIn&quot;
     * @param [transition.duration] {string}    Duration of transition
     * @param [callback] {Function}             Callback
     */
    Transitionable.prototype.set = function set(value, transition, callback) {
        if (!transition) {
            this.value = value;
            this.trigger(&#x27;start&#x27;, value);

            dirtyQueue.push(function () {
                this.trigger(&#x27;end&#x27;, value);
            }.bind(this));
            return;
        }

        if (callback) this._callback = callback;

        var curve = transition.curve;

        var method = (curve &amp;&amp; transitionMethods[curve])
            ? transitionMethods[curve]
            : Tween;

        if (this._method !== method) {
            if (this._engineInstance){
                if (this.updateMethod){
                    var index = tickQueue.indexOf(this.updateMethod);
                    if (index &gt;= 0) tickQueue.splice(index, 1);
                }
                this.unsubscribe(this._engineInstance);
            }

            if (this.value instanceof Array) {
                var dimensions = this.value.length;
                this._engineInstance = (dimensions &lt; method.DIMENSIONS)
                    ? new method(this.value)
                    : new NDTransitionable(this.value, method);
            }
            else this._engineInstance = new method(this.value);

            this.subscribe(this._engineInstance);
            this.updateMethod = this._engineInstance.update.bind(this._engineInstance);
            tickQueue.push(this.updateMethod);

            this._method = method;
        }

        if (!transition.velocity) transition.velocity = this.velocity;

        this._engineInstance.set(value, transition);
    };

    /**
     * Return the current state of the transition.
     *
     * @method get
     * @return {Number|Number[]}    Current state
     */
    Transitionable.prototype.get = function get() {
        return this.value;
    };

    /**
     * Return the current velocity of the transition.
     *
     * @method getVelocity
     * @return {Number|Number[]}    Current state
     */
    Transitionable.prototype.getVelocity = function getVelocity(){
        return this.velocity;
    };

    /**
     * Sets the value and velocity of the transition without firing any events.
     *
     * @method reset
     * @param value {Number|Number[]}       New value
     * @param [velocity] {Number|Number[]}  New velocity
     */
    Transitionable.prototype.reset = function reset(value, velocity){
        this.value = value;
        this.velocity = velocity || 0;
        this._callback = null;
        this._method = null;
        if (this._engineInstance) this._engineInstance.reset(value, velocity);
    };

    /**
     * Ends the transition in place.
     *
     * @method halt
     */
    Transitionable.prototype.halt = function () {
        this.reset(this.get());
        this.trigger(&#x27;end&#x27;, this.value);
    };

    /**
     * Determine is the transition is ongoing, or has completed.
     *
     * @method isActive
     * @return {Boolean}
     */
    Transitionable.prototype.isActive = function isActive() {
        return this._active;
    };

    /**
     * Iterate through the provided values with the provided transitions. Firing an
     *  optional callback when the series of transitions completes.
     *  One transition may be provided as opposed to an array when you want all the
     *  transitions to behave the same way.
     *
     * @method iterate
     * @param values {Array}                    Array of values
     * @param transitions {Object|Object[]}     Array of transitions
     * @param [callback] {Function}             Callback
     */
    Transitionable.prototype.iterate = function iterate(values, transitions, callback) {
        if (values.length === 0) {
            if (callback) callback();
            return;
        }

        // sugar for same transition across value changes
        var transition = (transitions instanceof Array)
            ? transitions.shift()
            : transitions;

        this.set(values.shift(), transition, function () {
            this.iterate(values, transitions, callback);
        }.bind(this));
    };

    /**
     * Combine multiple transitions to be executed sequentially. Provide the
     *  transitions as an array of transition definitions.
     *
     *  @example
     *
     *  transitionable.setMany([
     *      {value : 0, transition : {curve : &#x27;easeOut&#x27;, duration : 500}},
     *      {value : 1, transition : {curve : &#x27;spring&#x27;, period : 100, damping : 0.5}}
     *  ]);
     *
     * @method setMany
     * @param transitions {Array}   Array of transitions
     */
    Transitionable.prototype.setMany = function (transitions) {
        var first = transitions.shift();
        if (transitions.length === 0) {
            this.set(first.value, first.transition, first.callback)
        }
        else {
            this.set(first.value, first.transition, function () {
                this.setMany(transitions);
            }.bind(this));
        }
    };

    /**
     * Loop indefinitely between values with provided transitions array.
     *
     *  @example
     *
     *  transitionable.loop([
     *      {value : 0, transition : {curve : &#x27;easeOut&#x27;, duration : 500}},
     *      {value : 1, transition : {curve : &#x27;spring&#x27;, period : 100, damping : 0.5}}
     *  ]);
     *
     * @method loop
     * @param transitions {Array}   Array of transitions
     */
    Transitionable.prototype.loop = function (transitions) {
        var arrayClone = transitions.slice(0);
        this.setMany(transitions, function () {
            this.loop(arrayClone);
        }.bind(this));
    };

    /**
     * Postpone a transition, and fire it by providing it in the callback parameter.
     *
     * @method delay
     * @param callback {Function}   Callback
     * @param duration {Number}     Duration of delay (in millisecons)
     */
    Transitionable.prototype.delay = function delay(callback, duration) {
        this.set(this.get(), {
                duration: duration,
                curve: function () {
                    return 0;
                }
            },
            callback
        );
    };

    function NDTransitionable(value, method) {
        this._eventOutput = new EventHandler();
        EventHandler.setOutputHandler(this, this._eventOutput);

        this.sources = [];
        for (var i = 0; i &lt; value.length; i++) {
            var source = new method(value[i]);
            this.sources.push(source);
        }

        this.stream = Stream.merge(this.sources);
        this._eventOutput.subscribe(this.stream);
    }

    NDTransitionable.prototype.set = function (value, transition) {
        for (var i = 0; i &lt; value.length; i++)
            this.sources[i].set(value[i], transition);
    };

    NDTransitionable.prototype.getVelocity = function () {
        var velocity = [];
        for (var i = 0; i &lt; this.sources.length; i++)
            velocity[i] = this.sources[i].getVelocity();
        return velocity;
    };

    NDTransitionable.prototype.update = function () {
        for (var i = 0; i &lt; this.sources.length; i++)
            this.sources[i].update();
    };

    module.exports = Transitionable;
});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/yuidoc-bootstrap.js"></script>
<script>prettyPrint();</script>
</body>
</html>
